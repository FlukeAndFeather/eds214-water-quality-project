---
title: "Nutrient Concentrations"
author: Kylie Newcomer
format:
  html: 
    output-file: "paper.html"
warning: FALSE

---
# Background
This project reproduces Figure 3 from Schaefer et al 2000. The data for this project shows nutrient concentrations from streams of Bisley, Puerto Rico during 1986-1994, and analyzes the impacts of Hurricane Hugo on the concentrations.


```{r, echo = FALSE}
rm(list=ls())
library(tidyverse)
library(here)
library(janitor)
library(forecast)
library(zoo)
library(lubridate)
library(slider)
library(ARTofR)
library(paletteer)

```

# Data
```{r}
# Reading in cleaned data
conc_final <- readRDS(here("outputs", "conc_final.RDS"))
```


# Methods
```{r}
# Calling in my function
source(here("R", "rolling-mean-function.R"))
```


```{r}
# Applying function to data
conc_mean <- rolling_mean(conc_final)
```

# Results
```{r, fig.cap= "This figure shows the nutrient levels for rivers in Brisley, Puerto Rico with 1989 Hurricane Hugo denoted by the dotted line. Plots are broken up by the nutrients measured from top to bottom: Calcium, Potassium, Magnesium, Ammonium-N, and Nitrate-N"}
#Creating hurricane date variable for vline
hurricane <- as.Date("1989-09-18")

conc_mean_fig <- ggplot(conc_mean, aes(sample_date, roll_mean)) +
  geom_line(aes(color = sample_id)) +
  geom_vline(xintercept = hurricane, linetype = "dotted") + #adding huricane to graph
  scale_color_paletteer_d("nationalparkcolors::Arches") +
  facet_wrap(~nutrient, ncol = 1, scales = "free_y", strip.position = "left",
             labeller = as_labeller(
               c(ca = "Ca (mg l^-1)", 
                 k = "K (mg l^-1)", 
                 mg = "Mg (mg l^-1)", 
                 no3_n = "NO3-N (ug l^-1)", 
                 nh4_n = "NH4-N (ug l^-1)"))) +
  labs(x = "Years",
       y = "",
       color = "Site") +
  theme_minimal() +
  theme(strip.background = element_blank(), strip.placement = "outside", strip.text.y = element_text(size = 7.5), axis.text.y = element_text(size = 6))

conc_mean_fig
  
```

```{r}
ggsave(here("figs", "conc_mean_fig.png"), height = 5, width = 7)
```

