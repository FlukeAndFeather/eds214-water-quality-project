---
title: "Nutrient Concentrations"
format: html
warning: FALSE
---


#### Loading Packages and Data
```{r, echo = FALSE}
rm(list=ls())
library(tidyverse)
library(here)
library(janitor)
library(forecast)
library(zoo)
library(lubridate)
library(slider)
library(ARTofR)
library(paletteer)
library(viridis)

```

```{r}
# Reading in cleaned data
conc_final <- readRDS(here("outputs", "conc_final.RDS"))
```


#### Sourcing my function
```{r}
source(here("R", "rolling-mean-function.R"))
```

Creating the moving average
```{r}
conc_mean <- rolling_mean(conc_final)
```

#### Creating my figure
```{r, fig.cap= "This figure shows the nutrient levels for rivers in Brisley, Puerto Rico with 1989 Hurricane Hugo denoted by the dotted line. Graphs are broken up by the "}
#creating hurricane date variable
hurricane <- as.Date("1989-09-18")

ggplot(conc_mean, aes(sample_date, roll_mean)) +
  geom_line(aes(color = sample_id)) +
  geom_vline(xintercept = hurricane, linetype = "dotted") + #adding huricane to graph
  scale_color_paletteer_d("nationalparkcolors::Arches") +
  facet_wrap(~nutrient, ncol = 1, scales = "free_y", strip.position = "left",
             labeller = as_labeller(
               c(ca = "Ca (mg l^-1)", 
                 k = "K (mg l^-1)", 
                 mg = "Mg (mg l^-1)", 
                 no3_n = "NO3-N (ug l^-1)", 
                 nh4_n = "NH4-N (ug l^-1)"))) +
  labs(x = "Years",
       y = "",
       color = "Site") +
  theme_minimal() +
  theme(strip.background = element_blank(), strip.placement = "outside", strip.text.y = element_text(size = 7.5), axis.text.y = element_text(size = 6))
  
```
